@{
    ViewData["Title"] = "Rett i veier og stier";
}

<div class="text-center">
    <h1 class="display-4">Rett i veger og stier</h1>
    <p>Her kan du vise til endringer i kartet</p>
</div>

<!-- Flex container for map and where you edit the changes -->
<div class="map-change-container">
    <!-- Map section -->
    
    <button id="curLocationButton">Finn min posisjon</button>
    
    <div id="map" class="map-section"></div>
    
    <!-- Description section -->
    <div class="description-section">
        <form asp-action="RegisterAreaChange" method="post">
            <input type="hidden" id="geoJsonInput" name="geoJson" />
            <input type="hidden" id="kommunenavnInput" name="Kommunenavn" />
            <input type="hidden" id="kommunenummerInput" name="Kommunenummer" />
            <input type="hidden" id="fylkesnavnInput" name="Fylkesnavn" />
            <input type="hidden" id="fylkesnummerInput" name="Fylkesnummer" />

            <div>
                <label for="description">Beskriv endringen du vil melde:</label>
                <textarea id="description" name="Description" class="form-control"></textarea>
            </div>
            <br />
            <button type="submit" class="btn btn-primary">Send inn</button>
        </form>
    </div>
</div>


<!-- Example HTML to display kommune info -->
<div>
    <h3>Kommune Information</h3>
    <p>Kommunenavn: <span id="kommunenavn"></span></p>
    <p>Kommunenummer: <span id="kommunenummer"></span></p>
    <p>Fylkesnavn: <span id="fylkesnavn"></span></p>
    <p>Fylkesnummer: <span id="fylkesnummer"></span></p>
</div>

@section Scripts {
    <script src="~/js/leafletMap.js"></script>
    <script src="~/js/leafletDraw.js"></script>

    <script>
//Uses KommuneInfo API to fetch municipal information when map is clicked, 
//It then displays said information in this view
      map.on('click', function (e) {
        var latitude = e.latlng.lat;
        var longitude = e.latlng.lng;

        getKommuneInfo(latitude, longitude);
    });


// Function to send coordinates to the API

        function getKommuneInfo(latitude, longitude) {
            fetch(`/Home/GetKommuneInfo?latitude=${latitude}&longitude=${longitude}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json(); // Vi forventer JSON som svar
                })
                .then(data => {
                    if (data) {
                        // Behandle responsdataene (f.eks. oppdater visningen)
                        updateViewWithKommuneInfo(data); // Denne funksjonen må implementeres
                    } 
                })
                .catch(error => {
                    console.error('Error fetching kommune info:', error);
                });
        }


    // Function to update the view with kommune info
        function updateViewWithKommuneInfo(kommuneInfo) {
            console.log(kommuneInfo);

            document.getElementById("kommunenavn").innerText = kommuneInfo.kommunenavn || "Ikke tilgjengelig";
            document.getElementById("kommunenummer").innerText = kommuneInfo.kommunenummer || "Ikke tilgjengelig";
            document.getElementById("fylkesnavn").innerText = kommuneInfo.fylkesnavn || "Ikke tilgjengelig";
            document.getElementById("fylkesnummer").innerText = kommuneInfo.fylkesnummer || "Ikke tilgjengelig";


            // Set values in hidden fields
            document.getElementById("kommunenavnInput").value = kommuneInfo.kommunenavn || "";
            document.getElementById("kommunenummerInput").value = kommuneInfo.kommunenummer || "";
            document.getElementById("fylkesnavnInput").value = kommuneInfo.fylkesnavn || "";
            document.getElementById("fylkesnummerInput").value = kommuneInfo.fylkesnummer || "";
    }
    </script>
}
